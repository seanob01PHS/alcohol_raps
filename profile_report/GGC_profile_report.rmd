---
title: "GGC_qtr_report.rmd"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    css: www/css_styles.css
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(openxlsx)
library(tidyverse)
library(knitr)
library(reactable)
library(sparklines)
library(phsstyles)
library(plotly)
library(stringr)
library(crosstalk)
library(sjmisc)

source("process_wrangle.R")
source("table_output_profile.R")

data_dir <- "/conf/LIST_analytics/Glasgow City/Drugs & Alcohol/Alcohol/output/"
data <-  read.xlsx(paste0(data_dir, "GGC Alcohol Data.xlsx"), 1) %>% 
  select(-lookup)


data <- data %>% process_year()
#selecting the rows in the right order
data <- data[c("iz", "iz_name", "year_start", "year_str", "hscp", "indicator", "pop", "number", "rate")]


#gets largest year_start in data
population_year <- data %>%
  arrange(desc(year_start)) %>% 
  pull(year_start) %>% 
  .[[1]]

big_areas <- c("Scotland", "NHS Greater Glasgow and Clyde", "NHS GGC")
```

# Landing Page

# Profile

Inputs {.sidebar}
-------------------------------------
```{r crosstalk_filter}
all_table_data <- make_profile_frame(data) %>% arrange(desc(across(contains("hospital admissions"))))
table_data <- all_table_data %>% select(-contains("diff vs||"))

```


## row

### Profile

```{r reactable_1}
populations <- get_pops(table_data, data, population_year)
profile_table(all_table_data, populations, population_year)

```


```
