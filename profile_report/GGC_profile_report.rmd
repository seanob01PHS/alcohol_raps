---
title: "GGC_profile_report"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    css: www/css_styles.css
---



```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)

library(openxlsx)
library(tidyverse)
library(knitr)
library(reactable)
library(sparklines)
library(phsstyles)
library(plotly)
library(stringr)
library(crosstalk)
library(DT)
library(sjmisc)
```

```{r init, include=FALSE}
source("process_wrangle.R")
source("table_output_profile.R")

data_dir <- "/conf/LIST_analytics/Glasgow City/Drugs & Alcohol/Alcohol/output/"
data <-  read.xlsx(paste0(data_dir, "GGC Alcohol Data.xlsx"), 1) %>% 
  select(-lookup)


data <- data %>% process_year()
#selecting the rows in the right order
data <- data[c("iz", "iz_name", "year_start", "year_str", "hscp", "indicator", "pop", "number", "rate")]

big_areas <- c("Scotland", "NHS Greater Glasgow and Clyde", "NHS GGC")
```


# Profile

Inputs {.sidebar}
-------------------------------------


- This table shows information on various alcohol related harms indicators
- The EASR value and rate of change of the EASR from the previous period are shown for
  (@) **Alcohol Specific Deaths:** the time periods for this indicator are 3 calendar year aggregates.
  (@) **Alcohol-related mental health admissions:** the time periods for this indicator are 3 financial year aggregates.
  (@) **Alcohol-related hospital admissions:** the time periods for this indicator are single financial years.


```{r crosstalk_filter}
all_table_data <- make_profile_frame(data) %>% arrange(desc(across(contains("hospital admissions"))))

```


## row {.tabset}

### Profile Display

```{r reactable_display_profile}
download_table <- table_for_download(all_table_data)

shared_table_main <- SharedData$new(all_table_data, group="profile_table", key = ~iz)
shared_table_download <- SharedData$new(download_table, group="profile_table", key = ~iz)

profile_table(all_table_data, shared_table_main)

```

### Profile Download

```{r dt_download_profile}
datatable(shared_table_download,
          height=0.5,
          rownames = FALSE,
          extensions = 'Buttons',
          class = "diaply",
          options=list(dom = 'Bfrtip',
                        buttons = c('copy', 'csv', 'excel')))

```
